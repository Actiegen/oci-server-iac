name: Terraform OCI Provision

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  terraform:
    name: Apply Terraform
    runs-on: ubuntu-latest
    env:
        OCI_CLI_USER: ${{ secrets.OCI_CLI_USER }}
        OCI_CLI_TENANCY: ${{ secrets.OCI_CLI_TENANCY }}
        OCI_CLI_FINGERPRINT: ${{ secrets.OCI_CLI_FINGERPRINT }}
        OCI_CLI_KEY_CONTENT: ${{ secrets.OCI_CLI_KEY_CONTENT }}
        OCI_CLI_REGION: ${{ secrets.OCI_CLI_REGION }}
    steps:
    # - name: Checkout code
    #   uses: actions/checkout@v3

    # - name: Setup Terraform
    #   uses: hashicorp/setup-terraform@v3

    - name: Run an Oracle Cloud Infrastructure (OCI) CLI command
      uses: oracle-actions/run-oci-cli-command@v1.3.2
      with:
        command: 'iam compartment list --compartment-id-in-subtree=true'
        query: "data[?name=='testing'].id"

    # - name: Terraform Init
    #   run: |
    #     terraform init \
    #       -backend-config="region=${{ secrets.TF_VAR_REGION }}" \
    #       -backend-config="tenancy_ocid=${{ secrets.TF_VAR_tenancy_ocid }}"
    #       -backend-config="key=terraform.tfstate" \
    #       -backend-config="user_ocid=${{ secrets.TF_VAR_USER_OCID }}" \
    #       -backend-config="fingerprint=${{ secrets.TF_VAR_FINGERPRINT }}" \
    #       -backend-config="private_key_path=~/.oci/oci_api_key.pem" \
    #       -backend-config="auth=ApiKey" 

    # - name: Terraform Validate
    #   run: terraform validate

    # - name: Terraform Plan
    #   run: terraform plan

    # - name: Terraform Apply
    #   run: terraform apply -auto-approve
